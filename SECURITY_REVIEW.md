# Valki Talki Widget Security Review Checklist

- CSP expectations
  - Host pages can use strict `script-src`/`style-src` with nonces and no `unsafe-inline`.
  - Widget loader does not require `blob:` or `unsafe-eval`.
  - Ensure `connect-src` allows the API origin configured by `__VALKI_BASE_URL__`.

- postMessage origin checks
  - Validate `event.origin` against the trusted parent origin before acting.
  - Only post messages to the resolved parent origin (no wildcard targets).

- Token storage risks
  - Auth tokens live in storage; verify storage is scoped to widget origin.
  - Clear tokens on unauthorized responses.

- XSS surfaces (bot rendering)
  - Markdown rendering must avoid raw HTML injection.
  - Links are created with `rel="noopener noreferrer"`.

- Link hardening
  - External links open in new tab with `rel` protection.

- Image URL validation
  - Only accept `https:` in markdown images.
  - Attachment previews should use data URLs generated by client code.

- Clickjacking (frame-ancestors)
  - Widget hosting should define `frame-ancestors` policy per deployment needs.
  - Iframe mode isolates host CSS/JS while retaining parent origin checks.

- Dependency audit
  - No third-party runtime scripts are loaded by the widget.
  - Review build-time dependencies regularly.

- Privacy notes
  - Widget only sends messages to the configured API endpoint.
  - No analytics or tracking beacons are injected.
